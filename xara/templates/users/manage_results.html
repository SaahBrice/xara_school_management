{% extends "users/dashboard_base.html" %}
{% load crispy_forms_tags %}

{% block dashboard_content %}
<h2>Manage Results</h2>
<form method="post">
    {% csrf_token %}
    <div class="mb-3">
        <label for="academic_year">Academic Year:</label>
        <select id="academic_year" name="academic_year" class="form-control" required>
            <option value="">Select Academic Year</option>
            {% for year in academic_years %}
                <option value="{{ year.id }}">{{ year.year }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="class">Class:</label>
        <select id="class" name="class" class="form-control" required disabled>
            <option value="">Select Class</option>
        </select>
    </div>
    <div class="mb-3">
        <label for="student">Student:</label>
        <select id="student" name="student" class="form-control" required disabled>
            <option value="">Select Student</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Manage Results</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('academic_year').addEventListener('change', function() {
        const academicYearId = this.value;
        fetch(`/users/get-classes/?academic_year_id=${academicYearId}`)
            .then(response => response.json())
            .then(data => {
                const classSelect = document.getElementById('class');
                classSelect.innerHTML = '<option value="">Select Class</option>';
                data.forEach(cls => {
                    classSelect.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
                });
                classSelect.disabled = false;
            });
    });

    document.getElementById('class').addEventListener('change', function() {
        const classId = this.value;
        fetch(`/users/get-students/?class_id=${classId}`)
            .then(response => response.json())
            .then(data => {
                const studentSelect = document.getElementById('student');
                studentSelect.innerHTML = '<option value="">Select Student</option>';
                studentSelect.innerHTML += '<option value="all">All Students</option>';
                data.forEach(student => {
                    studentSelect.innerHTML += `<option value="${student.id}">${student.first_name} ${student.last_name}</option>`;
                });
                studentSelect.disabled = false;
            });
    });
</script>
{% endblock %}